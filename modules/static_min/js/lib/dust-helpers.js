!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define(["dust.core","moment"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin"),require("moment")):require(["moment"],function(n){t(e.dust,n)})}(this,function(e,t){function n(t,n,r){r=r||"INFO",t=t?"{@"+t+"}: ":"",e.log(t+n,r)}function r(e){f[e]||(n(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),n(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),f[e]=!0)}function s(e){return e.stack.tail&&e.stack.tail.head&&"undefined"!=typeof e.stack.tail.head.__select__}function i(e){return s(e)&&e.get("__select__")}function o(e,t){var n,r=e.stack.head,s=e.rebase();e.stack&&e.stack.tail&&(s.stack=e.stack.tail);var i={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)i[n]=t[n];return s.push({__select__:i}).push(r,e.stack.index,e.stack.of)}function a(e){var t,n;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;n>t;t++)e.deferreds[t]();e.isDeferredPending=!1}function c(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function u(e,t){return function(n,r,s,i){return d(n,r,s,i,e,t)}}function d(e,t,r,s,o,a){var c,u,d,f,k=r.block,p=r["else"],y=i(t)||{};if(y.isResolved&&!y.isDeferredPending)return e;if(s.hasOwnProperty("key"))u=s.key;else{if(!y.hasOwnProperty("key"))return n(o,"No key specified","WARN"),e;u=y.key}return f=s.type||y.type,u=l(t.resolve(u),f),d=l(t.resolve(s.value),f),a(u,d)?(y.isPending||(c=!0,y.isPending=!0),k&&(e=e.render(k,t)),c&&(y.isResolved=!0)):p&&(e=e.render(p,t)),e}function l(e,t){switch(t&&(t=t.toLowerCase()),t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e)}return e}var f={},k={tap:function(e,t,n){return r("tap"),n.resolve(e)},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,t,r,s){var i,o,a=t.resolve(s.to),u=t.resolve(s.key);switch(u){case"full":i=t.stack;break;default:i=t.stack.head}switch(o=JSON.stringify(i,c,2),a){case"console":n("contextDump",o);break;default:o=o.replace(/</g,"\\u003c"),e=e.write(o)}return e},toJSON:function(e,t,n,r){try{e.write(JSON.stringify(t.stack.head[r.data]))}catch(s){}return e},moment:function(e,n,r,s){var i;try{i=t(n.stack.head[s.data],s.def).format(s.format),e.write(i)}catch(o){i=n.stack.head[s.data],e.write(i)}finally{return e}},math:function(e,t,r,s){var c,u=s.key,d=s.method,l=s.operand,f=s.round;if(!s.hasOwnProperty("key")||!s.method)return n("math","`key` or `method` was not provided","ERROR"),e;switch(u=parseFloat(t.resolve(u)),l=parseFloat(t.resolve(l)),d){case"mod":0===l&&n("math","Division by 0","ERROR"),c=u%l;break;case"add":c=u+l;break;case"subtract":c=u-l;break;case"multiply":c=u*l;break;case"divide":0===l&&n("math","Division by 0","ERROR"),c=u/l;break;case"ceil":case"floor":case"round":case"abs":c=Math[d](u);break;case"toint":c=parseInt(u,10);break;default:n("math","Method `"+d+"` is not supported","ERROR")}return"undefined"!=typeof c&&(f&&(c=Math.round(c)),r&&r.block?(t=o(t,{key:c}),e=e.render(r.block,t),a(i(t))):e=e.write(c)),e},select:function(e,t,r,s){var c=r.block,u={};return s.hasOwnProperty("key")&&(u.key=t.resolve(s.key)),s.hasOwnProperty("type")&&(u.type=s.type),c?(t=o(t,u),e=e.render(c,t),a(i(t))):n("select","Missing body block","WARN"),e},eq:u("eq",function(e,t){return e===t}),ne:u("ne",function(e,t){return e!==t}),lt:u("lt",function(e,t){return t>e}),lte:u("lte",function(e,t){return t>=e}),gt:u("gt",function(e,t){return e>t}),gte:u("gte",function(e,t){return e>=t}),any:function(e,t,r,s){var o=i(t);return o?o.isDeferredComplete?n("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){o.deferreds.push(function(){o.isResolved&&(e=e.render(r.block,t)),e.end()})}):n("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,t,r,s){var o=i(t);return o?o.isDeferredComplete?n("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){o.deferreds.push(function(){o.isResolved||(e=e.render(r.block,t)),e.end()})}):n("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,n,r,s){var i,o,a=s.key;if(a=n.resolve(s.key),a&&a!==!0)if(e.isArray(a))i=a.length;else if(!isNaN(parseFloat(a))&&isFinite(a))i=a;else if("object"==typeof a){i=0;for(o in a)a.hasOwnProperty(o)&&i++}else i=(a+"").length;else i=0;return t.write(i)}};for(var p in k)e.helpers[p]=k[p];return e});